<link rel="import" href="/bower_components/core-icons/core-icons.html">
<link rel="import" href="/bower_components/core-icons/social-icons.html">
<link rel="import" href="/bower_components/core-icons/av-icons.html">
<link rel="import" href="/bower_components/paper-fab/paper-fab.html">
<link rel="import" href="/bower_components/core-animation/core-animation.html">

<polymer-element name="optinomic-module" attributes="module pageeditmode">

    <template>

        <link rel="stylesheet" href="/styles/components/components.css">
        <style>
        #full_content {
            margin-top: 24px;
            margin-bottom: 24px;
            width: 100%;
            min-height: 128px;
            background-color: white;
        }
        #bar {
            margin-top: 0px;
        }
        #top-bar, #paper_ripple {
            position: relative;
            height: 64px;
            width: 100%;
            padding: 0px 30px;
        }
        #content {
            padding-top: 12px;
        }
        #inner_content {
            padding: 0px 30px;
            min-height: 360px;
        }
        #title {
            padding: 10px 30px;
            margin-top: -24px;
            color: #283593;
            line-height: 48px;
            border-style: solid;
            border-color: #fafafa white white white;
            border-width: 1px;
            background-color: transparent;
        }
        #subtitle {
            padding: 10px 30px;
            margin-top: -36px;
            color: black;
        }
        .bottom-bar {
            position: relative;
            height: 64px;
            line-height: 64px;
            padding: 0px 30px;
            box-sizing: border-box;
            font-size: 18px;
        }
        .shadow {
            background-color: #fafafa;
            -moz-box-shadow: inset 0 6px 6px -6px rgba(0, 0, 0, 0.156863);
            -webkit-box-shadow: inset 0 6px 6px -6px rgba(0, 0, 0, 0.156863);
            box-shadow: inset 0 6px 6px -6px rgba(0, 0, 0, 0.156863);
        }
        .paper_z_1 {
            z-index:0;
            box-shadow:0 2px 5px 0 rgba(0, 0, 0, .26);
        }
        paper-fab {
            position: relative;
            top: -28px;
            right: 16px;
            color: white;
            background-color: rgb(66, 133, 244);
        }
        #core_card {
            position: relative;
            width: 100%;
            height: 48px;
            left: 0px;
            top: 0px;
            background-color: rgb(255, 255, 255);
        }
        #paper_ripple {
            width: 100%;
            height: 100%;
            margin-top: -12px;
            position: absolute;
            top: 0px;
            left: 0px;
        }
        #header {
            border-style: solid;
            border-color: #fafafa white white white;
            border-width: 1px;
        }
        #info {
            margin-top: 12px;
            padding: 0px 30px;
            color: #9e9e9e;
        }
        .spacer {
            margin-top: 24px;
        }
        #core_toolbar {
            right: 0px;
            left: 0px;
            color: rgb(0, 0, 0);
            fill: rgb(255, 255, 255);
            top: 0px;
            position: relative;
            background-color: rgb(255, 255, 255);
        }
        </style>




        <div id="full_content" class="{{ {paper_z_1: pageeditmode} | tokenList}}" vertical layout>

            <div id="header">
                <div class="g-wide--3 g-medium--half">
                    <optinomic-title header="{{ module.name }}" subtitle="{{ module.description }}" description="{{ module.full_description }}"></optinomic-title>
                </div>

                <template if="{{visible_front}}">
                    <div id="info" class="g-wide--1 g-wide--last g-medium--half g--last">
                        <p>
                            <core-icon icon="social:group"></core-icon>&nbsp; {{ module.responsibility }}
                            </br>
                            <core-icon icon="schedule"></core-icon>&nbsp; {{ module.schedule }}
                        </p>
                    </div>
                </template>
            </div>

            <div flex id="content">
                <div id="inner_content">

                    <template if="{{visible_front}}">
                        <content id="front_page" select="front"></content>
                    </template>
                    <template if="{{!visible_front}}">
                        <content id="back_page" select="back"></content>
                    </template>

                </div>
            </div>

            <template if="{{pageeditmode}}">
                <div id="bar" class="shadow bottom-bar" horizontal layout hero-id="punch-bottom" hero>
                    <div flex>{{ module.name }}</div>
                    <paper-fab icon="av:play-arrow" id="paper_fab" on-tap="{{ runAction }}" scale-up></paper-fab>
                </div>
            </template>


        </div>

    </template>



    <script>
    Polymer('optinomic-module', {

        publish: {
            pageeditmode: {
                reflect: true
            }
        },

        selected: false,



        ready: function() {
            // Initialize the instance's "list" property to empty array.
            this.module = this.module || [];
            this.pageeditmode = this.pageeditmode || [];
            this.visible_front = true;
            //this.my_edit_mode = this.editmode || false;

        },

        domReady: function() {
            console.log('optinomic-module: domReady : pageeditmode = ', this.pageeditmode);

            //var pageEdit = document.querySelector('optinomic-page');
            //pageEdit.addEventListener('toggle-edit-mode', function(e) {
            //    this.pageeditmode = !e.detail.editmode;
            //    console.log('optinomic-module: addEventListener - toggle-edit-mode: ', this.pageeditmode);
            //    
            //});

        },

        pageeditmodeChanged: function() {
            console.log('optinomic-module: editmodeChanged editmode = ', this.pageeditmode);
        },



        //attributeChanged: function(attrName, oldVal, newVal) {
        //    //var newVal = this.getAttribute(attrName);
        //    console.log(attrName, 'optinomic-module - attributeChanged - old: ' + oldVal, 'new:', newVal);
        //},



        toggleSelected: function() {
            this.selected = !this.selected;
            console.log('toggleSelected = ', this.selected);

            this.pageeditmode = !this.pageeditmode;
        },


        runEditMode: function() {
            alert('runEdit');
            console.log('runEdit!!!');
        },


        animate_front_back: function(direction) {

            //onclick="javascript:history.back();"
            console.log('animate_front_back');


            var animation_toggle_out = new CoreAnimation();
            animation_toggle_out.duration = 350;
            animation_toggle_out.fill = 'forwards';
            animation_toggle_out.keyframes = [{
                opacity: 1,
                width: '100%'
            }, {
                opacity: 0,
                width: '0%'
            }];
            animation_toggle_out.target = this.$.content;


            var animation_toggle_in = new CoreAnimation();
            animation_toggle_in.duration = 350;
            animation_toggle_in.fill = 'forwards';
            animation_toggle_in.keyframes = [{
                opacity: 0,
                width: '0%'
            }, {
                opacity: 1,
                width: '100%'
            }];
            animation_toggle_in.target = this.$.content;


            if (direction === 'in') {
                animation_toggle_in.play();
            } else {
                animation_toggle_out.play();
            }
        },


        runAction: function() {
            //console.log('runAction');

            //Get heigth of card
            var h = this.$.full_content.offsetHeight;
            //console.log('optinomic-module: domReady : height front_page = ', h);

            // Toggle (front / back)
            this.animate_front_back('out');
            this.visible_front = !this.visible_front;
            this.animate_front_back('in');
            //this.animate_front_back();

            //set height of card.
            this.$.full_content.style.minHeight = h + 'px';
        }
    });
    </script>

</polymer-element>